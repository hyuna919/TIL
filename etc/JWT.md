```
이전에 JWT를 공부하면서 잘 풀리지 않는 지점이 있었는데
트위터에서 현업자분들이 관련해서 이야기 하시는걸 보고 정리한 글입니다.
JWT에 대한 정리가 아니라 제가 혼자서는 찜찜하게 넘겼던 부분들 위주로 정리한 글입니다.
```

## 요약ver
- 등장배경 : 일반적인 세션 환경은 DB부하가 문제가 되니까 무상태stateless 세션이 필요할 때가 있다
- 정의 : 데이터를 전송했다는 주장(claim)을 표현하는 방식
	- "내가 보낸게 맞다! 공개키로 확인해보시지!"
	- =>인증에 쓰이긴 하지만 보안 때문에 나온 기술 아니다.
		탈취 문제는 JWT의 논점에서 벗어난다.
	        애초에 클라이언트에서 무언가가 탈취된다는 전제에서 웹서비스가 할 수 있는 건 매우 적다.
- 내가 했던 고민
	- 탈취 (-> 위에서 말함)
	- 효율 
		- DenyList라던가 로그인 수 제한을 구현하려는 순간 stateless가 아니게 된다.

---
## Full ver

### 정의
JWT는 디지털 서명에 대한 표준이지 인증only 아니다.
RFC에서의 정의 : 데이터를 전송했다는 주장(claim)을 표현하는 방식
== JWT란 두 개체가 정보 조각들(claims)를 안전하게 통신하게 하기 위한 개방형 표준이다.
보안적 관점에서 등장한 것이 아니라 탈취에 대한 걱정은 논점을 벗어난다.

중요한 것은 토큰이 서명으로 보장된 정보(payload)를 내재하고 있다는 점이다.
- 극단적으로 서버에 DB가 없더라도 내 비밀키로 서명한 JWT임이 맞다면 내가 생산했음을 보증할 수 있다.



### 구성
- header : 토큰인증법
- payload : json으로 작성
- signature : 날조되지 않았음을 증명

### 사용처
무상태stateless 세션 구현시 많이 쓰인다.
일반적인 세션을 DB에 상태 저장이 필요하지만 JWT는 토큰에 정보를 담고 있으니 DB조회 불필요.
-> 노출되도 되는 정보는 JWT에 담아서 전달하는게 효율적이겠구만

### 장점
- 웹 표준이라 호환성이 좋다(쿠키는 표준이 아니네;;)
- 상태세션을 사용하면 DB부하가 문제가 될 수 있는데 무상태 세션을 그에 대한 대안이다.
- 언어나 프레임워크에 귀속되지 않은 개방형 표준 중 JWT의 지원이 가장 좋은 편.
- 운영비용을 최대한 줄이고 싶거나, 순간부하가 심한 환경에서도 JWT를 채택하는 경우가 있다.
	- ex) 산타파이브의 '내 트리를 꾸며줘'
	- ex) 서버리스(예시를 정확히 이해는 못함) -> 정상적인 토큰인지만 알아도 충분한 경우


### 단점
- 네트워크 소모가 커진다
- 취약점(보안표준으로서는 질이 떨어진다는 의견이 있다.)
	- 인증방법을 header에 적어버리니까 해커들이 편해진다.(이미 몇번 패치가 있었음)
	- 인증방법인 "none"은 인증을 하지 않는 인증 방법임.
	- 인증된 토큰이 탈취된걸 알아도 차단할 방법이 없다.(강제 만료 등)
	  -> 차단리스트를 만드는건 결국 무상태 세션이 아니게 되니 JWT를 쓸 이유가 줄어듬
	- 그래서 대부분 전문가들은 사용자 세션은 framework에 내장된 세션 라이브러리 사용을 권장한다



### 혼란지점
- 탈취문제
	- "JWT가 탈취되면 안전하지 않다"는 말은 JWT의 문제가 아니다. 
	  : 클라이언트에서 뭔가 탈취가 되는 상황이 전제되는 순가 웹 서비스에서 할 수 있는 대책이 없다고 봐야한다.
  
- 차단문제
	- JWT는 세션의 대안이다(->무상태)
	- 효율을 위해 AllowList나 DenyList를 만드는 순간 Session을 만드는 꼴이 된다.
	- 동시 로그인 수를 제한을 고민하는 경우에도 Session을 만드는 꼴이 된다.



